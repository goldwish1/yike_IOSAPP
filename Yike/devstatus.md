# 忆刻开发计划

## MVP版本功能 (v1.0.0)

### 1. 内容输入模块
- [x] OCR文本识别
  - 相机调用与图片获取
  - Vision框架集成
  - 识别结果处理
- [x] 手动文本输入
  - 输入界面设计
  - 字数限制(250字)
  - 分段预览功能
- [x] 自动提取标题
- [x] 内容预览编辑
- [x] 内容删除功能
  - 长按/右滑触发删除选项
  - 删除确认弹窗
  - 数据清理逻辑

### 2. 播放控制模块
- [x] 文本转语音
  - AVSpeechSynthesizer集成
  - 预设音色选择
  - 音色效果优化
- [x] 播放控制
  - 播放/暂停
  - 上一句/下一句
  - 速度调节(0.5x-2.0x)
  - 波形动画
- [x] 自动循环播放
- [x] 播放设置
  - 间隔设置(5秒-20秒)
  - 音色选择
  - 默认速度设置
- [x] 语音试听功能
  - 设置页面实时试听
  - 音色效果预览

### 3. 艾宾浩斯记忆系统
- [x] 记忆提醒
  - 基于艾宾浩斯遗忘曲线
  - 本地提醒通知
  - 提醒时间设置
- [x] 复习策略
  - 简单/标准/密集三种模式
  - 自定义提醒时间
  - 进度追踪与更新
- [x] 学习进度追踪

### 4. 统计与数据
- [x] 学习统计
  - 完成项目统计
  - 学习时长统计
  - 统计图表展示
- [x] 数据管理
  - 本地数据存储
  - 数据导入导出
  - 备份与恢复
- [x] 本地存储

### 5. 积分系统
- [x] 积分明细
  - 收支记录
  - 消费详情
  - 日期过滤
- [x] 积分充值
  - 套餐选择
  - 支付接口
  - 订单管理
- [x] 积分消费

### 6. 设置中心
- [x] 播放设置
  - 预设音色选择（标准/轻柔/浑厚）
  - 播放控制
  - 默认参数
  - 语音试听功能
- [x] 提醒设置
  - 每日提醒
  - 提醒方式
  - 复习策略
- [x] 关于页面
  - 版本信息
  - 开发者信息
  - 联系方式

## 迭代版本功能

### v1.1.0
- [ ] 用户系统
  - 账号注册/登录
  - 个人资料设置
  - 用户数据同步
- [ ] 云端备份
  - 自动备份
  - 手动备份
  - 恢复备份

### v1.2.0
- [ ] 学习统计增强
  - 更丰富的统计图表
  - 学习效率分析
  - 学习习惯建议
- [ ] 波形显示
  - 音频可视化
  - 实时波形展示
- [ ] 多语言支持
  - 英语支持
  - 日语支持
- [ ] 学习计划
  - 自定义学习目标
  - 智能计划生成
- [ ] 数据分析
  - 学习效果分析
  - 个性化建议

### v1.3.0
- [ ] 多端同步
  - iPad适配
  - Mac版本
- [ ] AI助手
  - 智能纠错
  - 学习建议
- [ ] 社区功能
  - 学习圈子
  - 内容分享

## 最新进展

### 2024-03-16
1. 制定了积分消耗功能测试计划
   - 设计了单元测试、集成测试和UI测试方案
   - 确定了测试范围和测试用例
   - 规划了测试环境和模拟API服务
   - 明确了测试数据准备工作
   - 制定了测试实施步骤

### 2024-03-17
1. 完成了积分消耗功能测试实施
   - 实现了单元测试、集成测试和UI测试
   - 修复了测试中的警告和错误
   - 优化了MockSiliconFlowTTSService中的积分扣除逻辑
   - 确保了在线语音功能正确消耗5积分/次
   - 验证了OCR识别功能和试听功能免费
   - 使用方法交换技术解决了单例测试问题
   - 所有测试用例均已通过

### 2024-03-15
1. 调整了积分规则
   - 将拍照OCR识别功能改为免费
   - 将试听功能设置为免费
   - 保持在线语音功能消耗5积分/次不变
   - 确保试听功能使用缓存机制，避免重复请求API
   - 更新了相关UI显示和积分消耗逻辑
   - 更新了说明文本，明确试听功能免费

### 2024-03-14
1. 优化了播放页面导航功能
   - 实现了在播放页面直接切换不同记忆内容
   - 优化了上一条/下一条按钮的逻辑
   - 改进了播放状态的管理
   - 优化了播放页面的编辑按钮UI
   - 提升了用户操作体验

### 2024-03-13
1. 实现了内容编辑功能
   - 在PlayerView中添加了编辑入口
   - 扩展了PreviewEditView支持编辑模式
   - 实现了编辑后的数据更新逻辑
   - 添加了编辑后缓存清理功能
   - 优化了编辑后的导航体验

### 2024-03-12
1. 调整了在线语音功能的积分消耗
   - 将在线语音积分消耗从1积分调整为5积分
   - 更新了PlayerView中的积分检查逻辑
   - 更新了PlaySettingsView中的试听功能积分消耗
   - 更新了PointsCenterView中的积分说明文本
   - 优化了积分不足时的提示信息

### 2024-03-11
1. 开始集成硅基流动API语音合成服务
   - 制定了API集成计划
   - 设计了音频缓存系统架构
   - 规划了播放系统适配方案
   - 准备扩展音色选择功能

### 2024-03-10
1. 优化了播放设置界面
   - 简化了音色选择，合并为单一选项
   - 提供三种预设音色（标准、轻柔、浑厚）
   - 优化了音色参数，提高辨识度
   - 改进了试听功能的用户体验

### 2024-03-09
1. 优化了播放设置功能
   - 添加了语音试听功能
   - 优化了音色差异，提高辨识度
   - 修复了试听后无法停止的问题
   - 增加了音色效果说明

### 2024-03-08
1. 实现了OCR拍照输入功能
   - 集成了相机和照片库访问功能
   - 实现了Vision框架的文字识别
   - 添加了积分消费逻辑
   - 优化了识别过程中的用户体验
   - 支持中文和英文的多语言识别

### 2024-03-07
1. 优化了内容输入流程
   - 新增自动提取标题功能
   - 优化了保存后的导航逻辑

2. 改进了播放功能
   - 实现了自动循环播放
   - 优化了播放控制逻辑

3. 增加了内容管理功能
   - 新增内容删除功能（长按/右滑触发）
   - 添加删除确认机制

4. 修复了设置页面问题
   - 实现了用户协议、隐私政策和联系我们的跳转功能

### 2024-03-18
1. 制定了PlayerView功能拆分和重构计划
   - 分析了当前PlayerView.swift的功能和结构
   - 确定了代码存在的问题和优化方向
   - 制定了详细的拆分方案

2. 实施了PlayerView功能拆分和重构
   - 将SpeechManager移至独立文件
   - 创建了LocalVoicePlaybackManager处理本地语音播放
   - 创建了ApiVoicePlaybackManager处理API语音播放
   - 创建了PlaybackControlViewModel处理播放控制逻辑
   - 拆分UI组件：PlayerControlsView、PlaybackProgressView、WaveformAnimationView、SpeedSelectionView
   - 重构了PlayerView，使用MVVM架构
   - 优化了代码结构和可维护性

### 2024-03-19
1. 完成了导航系统升级
   - 创建了NavigationService和NavigationRouter服务类
   - 实现了iOS 16+和iOS 16以下版本的兼容性支持
   - 将NavigationView升级为NavigationStack
   - 使用新的navigationDestination API替换旧的NavigationLink
   - 优化了导航体验和过渡动画
   - 重构了导航相关代码以提高可维护性
   - 确保了向后兼容性，支持iOS 13.0+

## 待办事项

### 当前版本计划
1. [x] 内容编辑功能
   - [x] PlayerView添加编辑入口
   - [x] PreviewEditView扩展支持编辑模式
   - [x] 编辑后数据更新逻辑
   - [x] 编辑后缓存处理
   - [x] 用户体验优化

2. [x] OCR拍照输入功能
   - [x] 相机/相册访问集成
   - [x] Vision框架OCR实现
   - [x] 积分消费逻辑
   - [x] 识别结果编辑优化
   - [x] 多语言文本识别支持

3. [x] 播放设置优化
   - [x] 语音试听功能
   - [x] 音色选择简化
   - [x] 音色差异优化
   - [x] 试听控制修复

4. [x] 硅基流动API语音合成服务集成
   - [x] API客户端封装
     - API请求构建
     - 错误处理机制
     - 安全密钥管理
   - [x] 音频缓存系统
     - 本地缓存结构设计
     - 缓存查询与存储
     - 缓存过期策略
   - [x] 播放系统适配
     - 本地音频文件播放
     - 播放控制兼容
     - 播放状态管理
   - [x] 设置界面更新
     - 音色选项扩展
     - API音色试听功能
     - 音色分类管理

5. [x] 积分消耗功能测试
   - [x] 测试环境搭建
     - [x] XCTest框架配置
     - [x] 模拟API服务实现
     - [x] 测试数据准备
   - [x] 单元测试实现
     - [x] 积分核心逻辑测试
     - [x] 在线语音积分消耗测试
     - [x] OCR功能免费测试
     - [x] 试听功能免费测试
   - [x] 集成测试实现
     - [x] 积分系统与其他模块交互测试
     - [x] 积分变动后UI更新测试
   - [x] UI测试实现
     - [x] 积分不足提示界面测试
     - [x] 积分消耗后余额显示测试
   - [x] 测试报告与问题修复
     - [x] 测试结果分析
     - [x] 问题修复与验证

6. [x] PlayerView功能拆分和重构
   - [x] 代码分析与规划
     - [x] 分析当前代码结构和功能
     - [x] 确定拆分方向和模块划分
     - [x] 制定重构计划
   - [x] 核心功能拆分
     - [x] 将SpeechManager移至独立文件
     - [x] 创建LocalVoicePlaybackManager处理本地语音播放
     - [x] 创建ApiVoicePlaybackManager处理API语音播放
     - [x] 创建PlaybackControlViewModel处理播放控制逻辑
   - [x] UI组件拆分
     - [x] 创建PlayerControlsView处理播放控制UI
     - [x] 创建PlaybackProgressView处理进度显示
     - [x] 创建WaveformAnimationView处理波形动画
     - [x] 创建SpeedSelectionView处理速度选择
   - [x] 重构PlayerView
     - [x] 简化PlayerView，专注于组合UI组件
     - [x] 使用ViewModel处理业务逻辑
     - [x] 优化状态管理
     - [x] 改进错误处理
   - [ ] 测试与优化
     - [ ] 编写单元测试
     - [ ] 进行UI测试
     - [ ] 性能优化
     - [ ] 代码审查

### 下一版本计划
1. [ ] 用户系统
   - [ ] 账号注册登录
   - [ ] 数据云同步

2. [ ] 社交功能
   - [ ] 内容分享
   - [ ] 学习小组

3. [ ] AI 助手
   - [ ] 智能分析
   - [ ] 学习建议 

4. [x] 导航系统升级
   - [x] 将NavigationView升级为NavigationStack
   - [x] 使用新的navigationDestination API替换旧的NavigationLink
   - [x] 优化导航体验和过渡动画
   - [x] 重构导航相关代码以提高可维护性 